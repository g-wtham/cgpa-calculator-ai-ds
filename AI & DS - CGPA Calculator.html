<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>
    <title>AI & DS - CGPA Calculator</title>
    <style>
        table,
        th,
        td {
            border: 1px solid black;
            padding: 5px;
        }

        h2{
            text-align: center;
            margin: 20px;
        }

        body {
            min-height: 100vh;
        }

        footer {
            margin-top: 50px;
            width: 100%;
            background-color: #c9c8c8;
            padding: 7px;
            text-align: center;
        }
    </style>
</head>

<body ng-app="myApp">
    <h2>AI & DS - CGPA Calculator</h2>
    <main class="container" ng-controller="myCtrl">
        <div class="accordion accordion-flush" id="accordionExample">
            <div class="accordion-item" ng-repeat="sem in sem_data">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#{{'collapse-' + ($index+1)}}" aria-controls="{{'collapse-' + ($index+1)}}">
                        Semester #{{$index + 1}}
                    </button>
                </h2>
                <div id="{{'collapse-' + ($index+1)}}" class="accordion-collapse collapse"
                    data-bs-parent="#accordionExample">
                    <div class="accordion-body">
                        <table>
                            <thead>
                                <th>Course Name</th>
                                <th>Course Code</th>
                                <th>Credits</th>
                                <th>Grade</th>
                            </thead>
                            <tbody>
                                <tr ng-repeat="subject in sem">
                                    <td>{{subject.name}}</td>
                                    <td>{{subject.course_code}}</td>
                                    <td>{{subject.credit}}</td>
                                    <td>
                                        <select ng-model="subject.grade" ng-change="calc()">
                                            <option ng-repeat="grade in grades" value="{{grade.value}}"
                                                ng-selected="subject.grade === grade.value">
                                                {{grade.name}}
                                            </option>
                                        </select>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <table id="result" style="margin: 20px">
            <div style="margin: 20px;">
                <label for="name">Name:</label>
                <br>
                <input type="text" id="name" name="name">
                <br>
                <label for="roll_no">Roll No.:</label>
                <br>
                <input type="text" id="roll_no" name="roll_no">
             
            </div>
            <thead>
                <th>Semester</th>
                <th>SGPA</th>
                <th>CGPA</th>
            </thead>
            <tbody>
                <tr ng-repeat="sem in result">
                    <td>{{sem.sem}}</td>
                    <td>{{sem.sgpa}}</td>
                    <td>{{sem.cgpa}}</td>
                </tr>
            </tbody>
        </table>
    </main>

    <footer>
        <p>
            This code is based on <a href="https://info-lamin.vercel.app"> Lamin's</a> original work, modified by 
            <a href="https://github.com/g-wtham" target="_blank">Gowtham ðŸ’™</a>
        </p>
    </footer>

    <script>
        var app = angular.module('myApp', []);
        var scope
        app.controller('myCtrl', function ($scope) {
            $scope.sem_data = {
                "1": [
                    {
                        "name": "Induction Programme",
                        "course_code": "22MCT01",
                        "credit": 0,
                        "grade": ""
                    },
                    {
                        "name": "Communicative English",
                        "course_code": "22ENT11",
                        "credit": 3,
                        "grade": ""
                    },
                    {
                        "name": "Matrices and Differential Calculus",
                        "course_code": "22MAT12",
                        "credit": 4,
                        "grade": ""
                    },
                    {
                        "name": "Engineering Physics",
                        "course_code": "22PHT11",
                        "credit": 3,
                        "grade": ""
                    },
                    {
                        "name": "Engineering Chemistry",
                        "course_code": "22CYT11",
                        "credit": 3,
                        "grade": ""
                    },
                    {
                        "name": "Python Programming",
                        "course_code": "22CST11",
                        "credit": 3,
                        "grade": ""
                    },
                    {
                        "name": "Engineering Graphics",
                        "course_code": "22MET11",
                        "credit": 4,
                        "grade": ""
                    },
                    {
                        "name": "Physics and Chemistry Laboratory I",
                        "course_code": "22PHL11",
                        "credit": 1,
                        "grade": ""
                    },
                    {
                        "name": "Python Programming Laboratory",
                        "course_code": "22CSL11",
                        "credit": 1,
                        "grade": ""
                    },
                    {
                        "name": "Universal Human Values",
                        "course_code": "22MCT02",
                        "credit": 0,
                        "grade": ""
                    }
                ],
                "2": [
                    {
                        "name": "Professional English",
                        "course_code": "22ENT21",
                        "credit": 3,
                        "grade": ""
                    },
                    {
                        "name": "Probability and Statistics",
                        "course_code": "22MAT22",
                        "credit": 4,
                        "grade": ""
                    },
                    {
                        "name": "Physics for Information Sciences",
                        "course_code": "22PHT22",
                        "credit": 3,
                        "grade": ""
                    },
                    {
                        "name": "Basics of Electrical and Electronics Engineering",
                        "course_code": "22EET11",
                        "credit": 3,
                        "grade": ""
                    },
                    {
                        "name": "C Programming",
                        "course_code": "22ITT21",
                        "credit": 3,
                        "grade": ""
                    },
                    {
                        "name": "Physics And Chemistry Laboratory II",
                        "course_code": "22PHL21",
                        "credit": 1,
                        "grade": ""
                    },
                    {
                        "name": "C Programming Laboratory",
                        "course_code": "22ITL21",
                        "credit": 1,
                        "grade": ""
                    },
                    {
                        "name": "Engineering Practices Laboratory",
                        "course_code": "22EEL22",
                        "credit": 1,
                        "grade": ""
                    },
                    {
                        "name": "Environmental Science and Engineering",
                        "course_code": "22MCT03",
                        "credit": 0,
                        "grade": ""
                    },
                    {
                        "name": "Heritage of Tamils",
                        "course_code": "22HST11",
                        "credit": 1,
                        "grade": ""
                    }
                ],
                "3": [
                    {
                        "name": "Discrete Mathematics",
                        "course_code": "22MAT34",
                        "credit": 4,
                        "grade": ""
                    },
                    {
                        "name": "Foundations of Data Science",
                        "course_code": "22ADT31",
                        "credit": 3,
                        "grade": ""
                    },
                    {
                        "name": "Data Structures using Python",
                        "course_code": "22ADC31",
                        "credit": 4,
                        "grade": ""
                    },
                    {
                        "name": "Java Programming",
                        "course_code": "22ADT32",
                        "credit": 3,
                        "grade": ""
                    },
                    {
                        "name": "Digital Principles and Computer Organization",
                        "course_code": "22ADC32",
                        "credit": 4,
                        "grade": ""
                    },
                    {
                        "name": "Tamils and Technology",
                        "course_code": "22HST21",
                        "credit": 1,
                        "grade": ""
                    },
                    {
                        "name": "Java Programming Laboratory",
                        "course_code": "22ADL31",
                        "credit": 1,
                        "grade": ""
                    },
                    {
                        "name": "Data Science Laboratory",
                        "course_code": "22ADL32",
                        "credit": 1,
                        "grade": ""
                    }
                ],
                "4": [
                    {
                        "name": "Optimization Techniques and Queueing Theory",
                        "course_code": "22MAT42",
                        "credit": 4,
                        "grade": ""
                    },
                    {
                        "name": "Design and Analysis of Algorithms",
                        "course_code": "22ADT41",
                        "credit": 4,
                        "grade": ""
                    },
                    {
                        "name": "Operating Systems",
                        "course_code": "22ADC41",
                        "credit": 4,
                        "grade": ""
                    },
                    {
                        "name": "Database Management Systems",
                        "course_code": "22ADT42",
                        "credit": 3,
                        "grade": ""
                    },
                    {
                        "name": "Data Mining and Modeling",
                        "course_code": "22ADT43",
                        "credit": 4,
                        "grade": ""
                    },
                    {
                        "name": "Fundamentals of Artificial Intelligence",
                        "course_code": "22ADT44",
                        "credit": 3,
                        "grade": ""
                    },
                    {
                        "name": "Artificial Intelligence Laboratory",
                        "course_code": "22ADL41",
                        "credit": 1,
                        "grade": ""
                    },
                    {
                        "name": "Database Management Systems Laboratory",
                        "course_code": "22ADL42",
                        "credit": 1,
                        "grade": ""
                    },
                    {
                        "name": "English for Professionals",
                        "course_code": "22MCL04",
                        "credit": 2,
                        "grade": ""
                    }
                ]
            }

            $scope.grades = [
                {
                    'value': '',
                    'name': 'Grade'
                },
                {
                    'value': '10',
                    'name': 'O'
                },
                {
                    'value': '9',
                    'name': 'A+'
                },
                {
                    'value': '8',
                    'name': 'A'
                },
                {
                    'value': '7',
                    'name': 'B+'
                },
                {
                    'value': '6',
                    'name': 'B'
                },
                {
                    'value': '5',
                    'name': 'C'
                },
                {
                    'value': '0',
                    'name': 'RA/U/AB'
                }
            ]

            let local_data = JSON.parse(window.localStorage.getItem('result'))
            if(local_data){
                for (sem in $scope.sem_data) {
                    for (sub in $scope.sem_data[sem]) {
                        $scope.sem_data[sem][sub].grade = local_data[$scope.sem_data[sem][sub].course_code] || ""
                    }
                }
            }

            $scope.calc = () => {
                let data = []
                let final_data = {}

                let cgpa = 0
                let total_points = 0
                for (sem in $scope.sem_data) {
                    let sgpa = 0
                    let points = 0
                    for (sub in $scope.sem_data[sem]) {
                        let credit = $scope.sem_data[sem][sub].credit
                        let grade = parseInt($scope.sem_data[sem][sub].grade) || 0

                        if (grade != 0) {
                            sgpa += credit * grade
                            points += credit
                        }
                        final_data[$scope.sem_data[sem][sub].course_code] = $scope.sem_data[sem][sub].grade
                    }

                    cgpa += sgpa
                    total_points += points

                    data.push({
                        "sem": sem,
                        "sgpa": ((sgpa / points) || 0).toFixed(2),
                        "cgpa": ((cgpa / total_points) || 0).toFixed(2)
                    })
                }
                $scope.result = data
                window.localStorage.setItem('result', JSON.stringify(final_data))
            }

            $scope.calc()
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"></script>
</body>

</html>
